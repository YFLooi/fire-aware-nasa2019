<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Greenhouse gas emission visualiser</title>

     <!-- The core Firebase JS SDK is always required and must be listed first -->
     <!-- Original end of this url is 'firebase-app.js'. This does not work!! Use firebase.js instead-->
     <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase.js"></script>

     <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
 
     <script>
       // Your web app's Firebase configuration
       var firebaseConfig = {
         apiKey: "AIzaSyAplfPUP0ygPtbSQYWEG6cr2vlAl6misvw",
         authDomain: "nasa2019-a41ab.firebaseapp.com",
         databaseURL: "https://nasa2019-a41ab.firebaseio.com",
         projectId: "nasa2019-a41ab",
         storageBucket: "nasa2019-a41ab.appspot.com",
         messagingSenderId: "947284643043",
         appId: "1:947284643043:web:04f306d3ff8556dbde49d6"
       };
       // Initialize Firebase
       firebase.initializeApp(firebaseConfig);
     </script>


    <link rel="stylesheet" href="./css/mapStyles.css">
   
    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key (which is not needed for this tutorial)
    * The callback parameter executes the initMap() function
    -->
    <!--src to call API using assigned key: src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&CALL-STUFF-HERE" -->
    <!--'&callback=initMap' passes the calls to the Maps API made with initMap() on page load. Wait, does not work when page 
    loaded from Express backend?-->
    <!--'&libraries=visualization' Loads up google.maps.visualisation library for heatmaps-->
    <script type="text/javascript" async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCl6RtMrpOskELXpQocWoOqZxf_qT2y69M&libraries=visualization">
    </script>   
    <!--Scripts to operate Google Maps API-->
    <script type="text/javascript" src='./js/map.js'></script> 
    <script type="text/javascript" src="./js/bundle.js"></script>
    <!--Scripts to operate Canvas.js maps-->
    <script type="text/javascript" src="./canvas/canvasjs.min.js"></script>
    <script type="text/javascript" src="./js/chart.js"></script>
    <script type='text/javascript'>
      window.onload = function () {
        //Sets all checkboxes for chart element to 'checked' on page load
        //This prevents data from being already displayed but boxes being unchecked
        //which happens when chart first loads with pre-set data
        let chartElementToggle = document.getElementsByName('chartElement');
        for(let i=0; i<chartElementToggle.length; i++){
          chartElementToggle[i].checked = true
        }

        initMap();
        renderChart();
      }
    </script>

  <script type='text/javascript'>
    const database = firebase.database();

    function fetchDb(){
      database.ref('modis/1Sep2019').once('value', (snapshot) => {
        //Gets object attached to 'snapshot'
        //This comment pulls in the db data into an object
        const data = snapshot.val()
        
        //Will output an object. The object contains all data as its properties
        console.log(Object.keys(data).length);

        
        /*
        for(i=0 ; i<i++){

        }*/

      })
  
    }
  </script>
  </head>
  <body>
    <h3>Greenhouse gas emission visualiser</h3>
    <!--The div element for the map -->
    <button onclick="fetchDb()">db check</button>

    <div id='mapContainer'>
      <div id="map"></div>
    </div>
    <!--Serves as target to render <div>-s containing labels for popups-->
    <div id='popup-content'></div>
    
    <div id="floating-panel">
        <button type='button' class='btn btn-secondary' onclick="changeGHG()">CO2/CH4 toggle</button>
        <!--Recentres the viewport and clears all changes by re-rendering the onload map-->
        <button type='button' class='btn btn-secondary' onclick="initMap()">Reset map</button> 
        <button type='button' class='btn btn-secondary' onclick="toggleHeatmap()">Heatmap on/off</button>
        <button type='button' class='btn btn-secondary' onclick="changeGradient()">Darken background</button>
        <button type='button' class='btn btn-secondary' onclick="changeRadius()">Change radius</button>
        <button type='button' class='btn btn-secondary' onclick="changeOpacity()">Change opacity</button>
    </div>
    <p></p>
    <div>
        <p>
            Radius and intensity of heatmap center increases with CO2 (
            <span style='display:inline-block; width:10px; height: 10px; background-color:rgba(0, 255, 0, 1);'></span>
            ) and CH4 (
            <span style='display:inline-block; width:10px; height: 10px; background-color:rgb(255, 250, 0);'></span>
            ) concentration above baseline of CO2 and CH4 readings at San Clemente Island (SCI) 
        </p>
        <p>
            Click on map to show local elevation. Click on markers to display additional data for each location
        </p>
    </div>
    <p></p>
    <!--Canvas.js chart-->
    <div id="chartContainer" style="height: 300px; width: 100%;"></div>
    <div id="floating-panel">
        <button type='button' class='btn btn-secondary' onclick="updateChart()">Update chart data</button><br>
        <input type="checkbox" name="chartElement" value='CO2 (ppm)' checked onclick='toggleChartElements(0)'> Show CO2 &nbsp;
        <input type="checkbox" name="chartElement" value='CH4 (ppb)' checked onclick='toggleChartElements(1)'> Show CH4 &nbsp;
        <input type="checkbox" name="chartElement" value='T ambient (Â°C)' checked onclick='toggleChartElements(2)'> Show ambient temperature 
    </div>
    <p></p>
    <div>Gradient palette   
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(255, 255, 255, 0);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(0, 191, 255, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(0, 127, 255, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px;background-color:rgba(0, 63, 255, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(0, 0, 255, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(0, 0, 127, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(63, 0, 91, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(127, 0, 63, 1);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgba(255, 9, 9, 0.973);'>1</div>
        <div style='float: left; width: 20px; height: 20px; background-color:rgb(255, 214, 214);'>1</div>

        <div style='float: left; width: 20px; height: 20px; background-color:rgb(255, 251, 0);'>1</div>
    </div>
    
   
  </body>
</html>